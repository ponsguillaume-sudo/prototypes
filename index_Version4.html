<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kelkun Prototypes</title>
    <style>
        body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding: 32px; color:#111827 }
        h1 { font-size: 1.5rem; margin-bottom: 16px }
        .prototype-list { display: grid; gap: 12px }
        .prototype-card { display:block; padding:16px; border:1px solid #E5E7EB; border-radius:10px; text-decoration:none; color:inherit }
        .prototype-header { display:flex; align-items:center; gap:12px }
        .prototype-desc { color:#6B7280; font-size:0.938rem; line-height:1.6; margin-bottom:12px }
        .prototype-date { display:flex; align-items:center; gap:6px; font-size:0.8rem; color:#9CA3AF; padding-top:12px; border-top:1px solid #E5E7EB }
        .prototype-date svg { width:14px; height:14px; fill:currentColor }
        .sort-info { display:flex; align-items:center; gap:8px; font-size:0.875rem; color:#6B7280; margin-bottom:16px; padding:12px 16px; background:#F0FDF9; border-radius:10px; border:1px solid #00BFA620 }
        .sort-info svg { width:16px; height:16px; fill:#00BFA6 }
        .loading { color:#6B7280 }
        .spinner { width:18px; height:18px; border-radius:50%; border:3px solid #E5E7EB; border-top-color:#10B981; display:inline-block; animation:spin 1s linear infinite }
        @keyframes spin { to { transform:rotate(360deg) } }
    </style>
</head>
<body>
    <h1>üé® Kelkun Prototypes</h1>

    <div class="sort-info">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/></svg>
        Tri√© du plus r√©cent au plus ancien
    </div>

    <div id="prototype-list" class="prototype-list">
        <div class="loading">
            <div class="spinner"></div>
            R√©cup√©ration des prototypes...
        </div>
    </div>

    <script>
        // Configuration
        const GITHUB_USERNAME = 'ponsguillaume-sudo';
        const REPO_NAME = 'prototypes';
        const BRANCH = 'main';
        const USE_GHPAGES = true; // true => link to GitHub Pages; false => link to GitHub blob view

        const fileMetadata = {};

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }
        function getRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            if (diffMins < 1) return "√Ä l'instant";
            if (diffMins < 60) return `Il y a ${diffMins} min`;
            if (diffHours < 24) return `Il y a ${diffHours}h`;
            if (diffDays === 1) return 'Hier';
            if (diffDays < 7) return `Il y a ${diffDays} jours`;
            if (diffDays < 30) return `Il y a ${Math.floor(diffDays / 7)} sem.`;
            return formatDate(dateString);
        }

        function getFileHref(filename) {
            const encodedName = encodeURIComponent(filename);
            if (USE_GHPAGES) {
                return `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/${encodedName}`;
            }
            return `https://github.com/${GITHUB_USERNAME}/${REPO_NAME}/blob/${BRANCH}/${encodedName}`;
        }

        async function loadPrototypes() {
            const listContainer = document.getElementById('prototype-list');
            listContainer.innerHTML = `<div class="loading"><div class="spinner"></div> R√©cup√©ration des prototypes...</div>`;
            try {
                const res = await fetch('/prototypes.json');
                if (!res.ok) {
                    listContainer.innerHTML = `<div class="error">Impossible de r√©cup√©rer prototypes.json (HTTP ${res.status}). L'action n'a peut-√™tre pas encore g√©n√©r√© le fichier.</div>`;
                    return;
                }
                const manifest = await res.json();
                const filesWithDates = Array.isArray(manifest.files) ? manifest.files : [];
                if (filesWithDates.length === 0) {
                    listContainer.innerHTML = `<div class="error">Aucun prototype trouv√©. Uploadez vos fichiers HTML !</div>`;
                    return;
                }
                filesWithDates.sort((a,b) => {
                    if (!a.createdAt && !b.createdAt) return 0;
                    if (!a.createdAt) return 1;
                    if (!b.createdAt) return -1;
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
                listContainer.innerHTML = filesWithDates.map(file => {
                    const metadata = fileMetadata[file.name] || { emoji: 'üìÑ', title: file.name.replace('.html','').replace(/-/g,' '), desc: '' };
                    const sizeKB = (file.size / 1024).toFixed(1);
                    const newBadge = metadata.isNew ? '<span class="badge new">NEW</span>' : '';
                    const dateInfo = file.createdAt ? `<div class="prototype-date"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg><span>Cr√©√© le ${formatDate(file.createdAt)}</span><span style="color: #D1D5DB;">‚Ä¢</span><span>${getRelativeTime(file.createdAt)}</span></div>` : '';
                    const href = getFileHref(file.name);
                    return `
                        <a href="${href}" class="prototype-card" target="_blank" rel="noopener noreferrer">
                            <div class="prototype-header">
                                <div>${metadata.emoji}</div>
                                <div>
                                    <div style="font-weight:600">${metadata.title} ${newBadge}</div>
                                    <div style="font-size:0.9rem;color:#6B7280">${sizeKB} KB</div>
                                </div>
                            </div>
                            <p class="prototype-desc">${metadata.desc}</p>
                            ${dateInfo}
                        </a>
                    `;
                }).join('');
            } catch (err) {
                console.error(err);
                listContainer.innerHTML = `<div class="error">Une erreur est survenue lors de la r√©cup√©ration des prototypes.</div>`;
            }
        }
        loadPrototypes();
    </script>
</body>
</html>